<style>
    body {
        background-color: #fbfbfb;
    }

    .card {
        width: 400px;
        border-radius: 10px;
        overflow: hidden;
    }

    .card[loading] .loading {
        display: block;
    }

    .loading {
        display: none;
        position: absolute;
        inset: 0px;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
    }

    .loading .spinner-border {
        position: absolute;
        inset: 0px;
        margin: auto;
    }

    .parent {
        display: flex;
        vertical-align: middle;
        align-items: center;
        width: 100vw;
        height: 100vh;
        justify-content: center;
    }

    .google-signin {
        display: flex;
        border-radius: 5px;
        margin: 20px 10px;
        background: #4285f4;
        color: white;
        cursor: pointer;
        text-decoration: none;
    }

    .google-signin img {
        height: 45px;
        padding: 10px;
        background: white;
        border-radius: 5px 0px 0px 5px;
    }

    .google-signin span {
        margin: 10px 0px 0px 15px;
    }
</style>

<div class="parent">
    <div class="card p-4" id="cardLogin">
        <div class="text-center pt-4">
            <h5 class="brand">Boats, Boats, Boats</h5>
            <h5 class="pt-4 pb-2">Sign Up</h5>
            <h6>Create your Boats Account</h6>
        </div>
        <div>
            <a class="google-signin shadow" href="/auth/google">
                <img src="data:image/png;base64,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" />
                <span>Sign Up With Google</span>
            </a>
        </div>
        <form onsubmit="login(); return false;">
            <div class="form-group mx-sm-3 mb-2">
                <label for="inputEmail" class="sr-only">Email</label>
                <input type="email" class="form-control" id="inputEmail" placeholder="Email">
            </div>
            <div class="form-group mx-sm-3 mb-2">
                <label for="inputPassword" class="sr-only">Password</label>
                <input type="password" class="form-control" id="inputPassword" placeholder="Password">
            </div>
            <p class="text-danger text-center" id="errorText"></p>
            <div class="form-check mx-sm-3 mb-2">
                <input class="form-check-input" type="checkbox" required id="flexCheckDefault" >
                <label class="form-check-label" for="flexCheckDefault">
                    Agree to <a href="/privacy" class="text-primary" target="_blank">Privacy Policy</a>
                </label>
            </div>
            <div class="row mx-sm-3 flex-nowrap">
                <a class="w-auto text-decoration-none pt-2" href="/login">Sign In</a>
                <div class="flex-grow-1 w-auto"></div>
                <button type="submit" class="w-auto btn btn-primary">Register</button>
            </div>
        </form>
        <div class="loading">
            <div class="spinner-border text-primary" role="status"></div>
        </div>
    </div>
</div>

<script>

let dangerText = document.getElementById('errorText');
let cardObject = document.getElementById('cardLogin');

async function login() {

    // Clear error
    dangerText.innerText = '';
    cardObject.setAttribute('loading', 'true');

    let email = document.getElementById('inputEmail').value;
    let password = document.getElementById('inputPassword').value;

    try {
        let res = await sendRequest('/register', 'post', {
            user: email,
            pwd: password
        }, false)

        let data = await res.json();

        if (res.status >= 300 || res.status < 200) {
            // Error
            dangerText.innerText = data.message ?? 'Unknown error';
            cardObject.removeAttribute('loading');
            return;
        }

        // Get login token
        res = await sendRequest('/auth', 'post', {
            user: email,
            pwd: password
        })

        data = await res.json();

        if (res.status >= 300 || res.status < 200) {
            // Error
            dangerText.innerText = 'Account created, but encountered error signing in: ' + data.message ?? 'Account created, but encountered unknown error signing';
            cardObject.removeAttribute('loading');
            return;
        }

        // Success, redirect
        window.location = '/'
    } catch (e) {
        dangerText.innerText = e.message;
    }

    cardObject.removeAttribute('loading');
}
</script>